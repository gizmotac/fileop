import X,{Headers as Y,Request as K,Response as Z}from"node-fetch";import tt from"./@qwik-city-plan.mjs";import et from"./entry.ssr.mjs";import E from"express";import{fileURLToPath as nt}from"node:url";import{join as q}from"node:path";import ot from"compression";import"@builder.io/qwik";import"@builder.io/qwik/jsx-runtime";import"@builder.io/qwik-react";import"react/jsx-runtime";import"@mui/material";import"react";import"axios";import"material-table";import"@material-ui/lab";import"@material-ui/core";import"@mui/material/Card/index.js";import"@mui/material/CardContent/index.js";import"@mui/material/CardHeader/index.js";import"@mui/material/Grid/index.js";import"@mui/material/Avatar/index.js";import"@mui/material/IconButton/index.js";import"@mui/material/Typography/index.js";import"@mui/material/colors/index.js";import"@mui/icons-material/Settings.js";import"@mui/material/Button/index.js";import"@mui/material/styles/index.js";import"@mui/material/Dialog/index.js";import"@mui/material/DialogTitle/index.js";import"@mui/material/DialogContent/index.js";import"@mui/material/DialogActions/index.js";import"@mui/icons-material/Close.js";import"@builder.io/qwik/server";var y=Symbol("headers"),O,st=class{constructor(){this[O]={}}[(O=y,Symbol.iterator)](){return this.entries()}*keys(){for(const t of Object.keys(this[y]))yield t}*values(){for(const t of Object.values(this[y]))yield t}*entries(){for(const t of Object.keys(this[y]))yield[t,this.get(t)]}get(t){return this[y][P(t)]||null}set(t,e){const n=P(t);this[y][n]=typeof e!="string"?String(e):e}append(t,e){const n=P(t),o=this.has(n)?`${this.get(n)}, ${e}`:e;this.set(t,o)}delete(t){if(!this.has(t))return;const e=P(t);delete this[y][e]}all(){return this[y]}has(t){return this[y].hasOwnProperty(P(t))}forEach(t,e){for(const n in this[y])this[y].hasOwnProperty(n)&&t.call(e,this[y][n],n,this)}},rt=/[^a-z0-9\-#$%&'*+.^_`|~]/i;function P(t){if(typeof t!="string"&&(t=String(t)),rt.test(t)||t.trim()==="")throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function H(){return new(typeof Headers=="function"?Headers:st)}var T=class extends Error{constructor(t,e){super(e),this.status=t}};function it(t){return U(t,new T(404,"Not Found"))}function F(t,e){const o=I(500,e),s=H();return s.set("Content-Type","text/html; charset=utf-8"),t.response(500,s,async r=>{r.write(o)},e)}function U(t,e){const n=M(e.status,e.message,e.stack),o=H();return o.set("Content-Type","text/html; charset=utf-8"),t.response(e.status,o,async s=>{s.write(n)},e)}function I(t,e){let n="Server Error",o;return e!=null&&(typeof e=="object"?(typeof e.message=="string"&&(n=e.message),e.stack!=null&&(o=String(e.stack))):n=String(e)),M(t,n,o)}function M(t,e,n){const o=typeof e=="string"?"600px":"300px",s=t>=500?ct:at;return t<500&&(n=""),`<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="Status" content="${t}"/>
  <title>${t} ${e}</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body { color: ${s}; background-color: #fafafa; padding: 30px; font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, Roboto, sans-serif; }
    p { max-width: ${o}; margin: 60px auto 30px auto; background: white; border-radius: 4px; box-shadow: 0px 0px 50px -20px ${s}; overflow: hidden; }
    strong { display: inline-block; padding: 15px; background: ${s}; color: white; }
    span { display: inline-block; padding: 15px; }
    pre { max-width: 580px; margin: 0 auto; }
  </style>
</head>
<body>
  <p>
    <strong>${t}</strong>
    <span>${e}</span>
  </p>
  ${n?`<pre><code>${n}</code></pre>`:""}
</body>
</html>
`}var at="#006ce9",ct="#713fc2",x=new WeakMap,lt=async(t,e,n,o)=>{if(Array.isArray(t))for(const s of t){const r=s[0].exec(o);if(r){const i=s[1],a=ft(s[2],r),c=s[4],l=new Array(i.length),d=[],m=dt(e,o);let f;return i.forEach((g,p)=>{B(g,d,k=>l[p]=k,n)}),B(m,d,g=>f=g==null?void 0:g.default,n),d.length>0&&await Promise.all(d),[a,l,f,c]}}return null},B=(t,e,n,o)=>{if(typeof t=="function"){const s=x.get(t);if(s)n(s);else{const r=t();typeof r.then=="function"?e.push(r.then(i=>{o!==!1&&x.set(t,i),n(i)})):r&&n(r)}}},dt=(t,e)=>{if(t){const n=t.find(o=>o[0]===e||e.startsWith(o[0]+(e.endsWith("/")?"":"/")));if(n)return n[1]}},ft=(t,e)=>{const n={};if(t)for(let o=0;o<t.length;o++)n[t[o]]=e?e[o+1]:"";return n},R=class{constructor(t,e,n){this.url=t,this.location=t,this.status=J(e)?e:302,this.headers=n||H(),this.headers.set("Location",this.location),this.headers.delete("Cache-Control")}};function ut(t,e){return t.response(e.status,e.headers,async()=>{})}function J(t){return typeof t=="number"&&t>=301&&t<=308}async function pt(t,e,n,o,s="/"){if(n.length===0)throw new T(404,"Not Found");const{request:r,url:i,platform:a}=t,{pathname:c}=i,l=ht(n),d=l&&r.headers.get("Accept")==="application/json",m=d?"pagedata":l?"pagehtml":"endpoint",f={type:m,url:i,params:e,status:200,headers:H(),resolvedBody:void 0,pendingBody:void 0,aborted:!1};let g=!1;if(l&&c!==s){if(o){if(!c.endsWith("/"))throw new R(c+"/"+i.search,302)}else if(c.endsWith("/"))throw new R(c.slice(0,c.length-1)+i.search,302)}let p=-1;const k=()=>{p=D},S=(h,u)=>new R(h,u,f.headers),G=(h,u)=>new T(h,u),A=async()=>{for(p++;p<n.length;){const h=n[p];let u;switch(r.method){case"GET":{u=h.onGet;break}case"POST":{u=h.onPost;break}case"PUT":{u=h.onPut;break}case"PATCH":{u=h.onPatch;break}case"OPTIONS":{u=h.onOptions;break}case"HEAD":{u=h.onHead;break}case"DELETE":{u=h.onDelete;break}}if(u=u||h.onRequest,typeof u=="function"){g=!0;const Q={get status(){return f.status},set status(b){f.status=b},get headers(){return f.headers},redirect:S,error:G},V={request:r,url:new URL(i),params:{...e},response:Q,platform:a,next:A,abort:k},w=u(V);if(typeof w=="function")f.pendingBody=C(w);else if(w!==null&&typeof w=="object"&&typeof w.then=="function"){const b=await w;typeof b=="function"?f.pendingBody=C(b):f.resolvedBody=b}else f.resolvedBody=w}p++}};if(await A(),f.aborted=p>=D,!d&&J(f.status)&&f.headers.has("Location"))throw new R(f.headers.get("Location"),f.status,f.headers);if(m==="endpoint"&&!g)throw new T(405,"Method Not Allowed");return f}function C(t){return new Promise((e,n)=>{try{const o=t();o!==null&&typeof o=="object"&&typeof o.then=="function"?o.then(e,n):e(o)}catch(o){n(o)}})}function ht(t){const e=t[t.length-1];return e&&typeof e.default=="function"}function yt(t,e){let n=t.url.pathname;if(n.endsWith(W)){t.request.headers.set("Accept","application/json");const o=n.length-mt+(e?1:0);n=n.slice(0,o),n===""&&(n="/"),t.url.pathname=n}}var W="/q-data.json",mt=W.length,D=999999999;function gt(t,e){const{pendingBody:n,resolvedBody:o,status:s,headers:r}=e,{response:i}=t;if(n===void 0&&o===void 0)return i(s,r,wt);r.has("Content-Type")||r.set("Content-Type","application/json; charset=utf-8");const a=r.get("Content-Type").includes("json");return i(s,r,async({write:c})=>{const l=n!==void 0?await n:o;if(l!==void 0)if(a)c(JSON.stringify(l));else{const d=typeof l;c(d==="string"?l:d==="number"||d==="boolean"?String(l):l)}})}var wt=async()=>{};function vt(t,e,n,o,s){const{status:r,headers:i}=e,{response:a}=t,c=e.type==="pagedata";return c?i.set("Content-Type","application/json; charset=utf-8"):i.has("Content-Type")||i.set("Content-Type","text/html; charset=utf-8"),a(c?200:r,i,async l=>{try{const d=await n({stream:c?Rt:l,envData:Pt(e),...o});c?l.write(JSON.stringify(await N(e,d,s))):(typeof d).html==="string"&&l.write(d.html),typeof l.clientData=="function"&&l.clientData(await N(e,d,s))}catch(d){const m=I(500,d);l.write(m)}})}async function N(t,e,n){var o;const s=bt(e,n),r=!((o=e.snapshotResult)!=null&&o.resources.some(a=>a._cache!==1/0));return{body:t.pendingBody?await t.pendingBody:t.resolvedBody,status:t.status!==200?t.status:void 0,redirect:t.status>=301&&t.status<=308&&t.headers.get("location")||void 0,isStatic:r,prefetch:s.length>0?s:void 0}}function bt(t,e){const n=[],o=a=>{a&&!n.includes(a)&&n.push(a)},s=a=>{if(Array.isArray(a))for(const c of a){const l=c.url.split("/").pop();l&&!n.includes(l)&&(o(l),s(c.imports))}};s(t.prefetchResources);const r=t.manifest||t._manifest,i=t._symbols;if(r&&i)for(const a of i){const c=r.symbols[a];c&&c.ctxName==="component$"&&o(r.mapping[a])}if(e)for(const a of e)o(a);return n}function Pt(t){const{url:e,params:n,pendingBody:o,resolvedBody:s,status:r}=t;return{url:e.href,qwikcity:{params:{...n},response:{body:o||s,status:r}}}}var Rt={write:()=>{}};async function Tt(t,e){try{const{render:n,qwikCityPlan:o}=e,{routes:s,menus:r,cacheModules:i,trailingSlash:a,basePathname:c}=o;yt(t,a);const l=await lt(s,r,i,t.url.pathname);if(l){const[d,m,f,g]=l,p=await pt(t,d,m,a,c);return p.aborted?null:p.type==="endpoint"?await gt(t,p):await vt(t,p,n,e,g)}}catch(n){return n instanceof R?ut(t,n):n instanceof T?U(t,n):F(t,n)}return null}function $(t){const e=t.socket.encrypted||t.connection.encrypted?"https":"http";return new URL(t.url||"/",`${e}://${t.headers.host}`)}function _(t,e,n){const o=H(),s=e.headers;for(const a in s){const c=s[a];if(typeof c=="string")o.set(a,c);else if(Array.isArray(c))for(const l of c)o.append(a,l)}const r=async()=>{const a=[];for await(const c of e)a.push(c);return Buffer.concat(a).toString()};return{request:{headers:o,formData:async()=>new URLSearchParams(await r()),json:async()=>JSON.parse(await r()),method:e.method||"GET",text:r,url:t.href},response:async(a,c,l)=>(n.statusCode=a,c.forEach((d,m)=>n.setHeader(m,d)),l({write:d=>{n.write,n.write(d)}}).finally(()=>{n.end()}),n),url:t,platform:{ssr:!0,node:process.versions.node}}}function Ht(){typeof global<"u"&&typeof globalThis.fetch!="function"&&typeof process<"u"&&process.versions.node&&(globalThis.fetch||(globalThis.fetch=X,globalThis.Headers=Y,globalThis.Request=K,globalThis.Response=Z))}function kt(t){return Ht(),{router:async(o,s,r)=>{try{const i=_($(o),o,s);try{await Tt(i,t)||r()}catch(a){await F(i,a)}}catch(i){console.error(i),r(i)}},notFound:async(o,s,r)=>{try{const i=_($(o),o,s);await it(i)}catch(i){console.error(i),r(i)}}}}const z=q(nt(import.meta.url),"..","..","dist"),Et=q(z,"build");var j;const L=(j=process.env.PORT)!=null?j:3e3,{router:St,notFound:At}=kt({render:et,qwikCityPlan:tt}),v=E();v.use(ot());v.use("/build",E.static(Et,{immutable:!0,maxAge:"1y"}));v.use(E.static(z,{redirect:!1}));v.use(St);v.use(At);v.listen(L,()=>{console.log(`Server starter: http://localhost:${L}/`)});
